# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #


# closing the sections provides an overview of the script

# required model files:
# m___sim.stan
# where ___ is a placeholder


# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #



# general prep ####
# set working directory
setwd("C:/Users/Diiim/Documents/job_uni/Master/Thesis/F1_project")

# clean workspace
rm(list = ls())


# clean garbage
gc()


# clear graphics device
# dev.off()


# set decimals to digits instead of scientific
options(scipen = 999)


# load packages
library(todor)
# todor::todor_file("R/simulated_data.R")

library(rstan)
options(mc.cores = parallel::detectCores())
rstan_options(auto_write = TRUE)

library(readxl)
library(rethinking)



# model 1 version 1 - clean data ####
# number of constructors in time series
K <- 11

# number of drivers in time series
N <- 22

# number of qualifiers/races
Q <- 159

# constructor qualifier/race NA indicators
I_3 <- matrix(data = 1, nrow = K, ncol = Q)

# constructor indicators
I_2_1 <- matrix(data = NA, nrow = N, ncol = K)
I_2_1[1,] <- c(1,0,0,0,0,0,0,0,0,0,0)
I_2_1[2,] <- c(1,0,0,0,0,0,0,0,0,0,0)
I_2_1[3,] <- c(0,1,0,0,0,0,0,0,0,0,0)
I_2_1[4,] <- c(0,1,0,0,0,0,0,0,0,0,0)
I_2_1[5,] <- c(0,0,1,0,0,0,0,0,0,0,0)
I_2_1[6,] <- c(0,0,1,0,0,0,0,0,0,0,0)
I_2_1[7,] <- c(0,0,0,1,0,0,0,0,0,0,0)
I_2_1[8,] <- c(0,0,0,1,0,0,0,0,0,0,0)
I_2_1[9,] <- c(0,0,0,0,1,0,0,0,0,0,0)
I_2_1[10,] <- c(0,0,0,0,1,0,0,0,0,0,0)
I_2_1[11,] <- c(0,0,0,0,0,1,0,0,0,0,0)
I_2_1[12,] <- c(0,0,0,0,0,1,0,0,0,0,0)
I_2_1[13,] <- c(0,0,0,0,0,0,1,0,0,0,0)
I_2_1[14,] <- c(0,0,0,0,0,0,1,0,0,0,0)
I_2_1[15,] <- c(0,0,0,0,0,0,0,1,0,0,0)
I_2_1[16,] <- c(0,0,0,0,0,0,0,1,0,0,0)
I_2_1[17,] <- c(0,0,0,0,0,0,0,0,1,0,0)
I_2_1[18,] <- c(0,0,0,0,0,0,0,0,1,0,0)
I_2_1[19,] <- c(0,0,0,0,0,0,0,0,0,1,0)
I_2_1[20,] <- c(0,0,0,0,0,0,0,0,0,1,0)
I_2_1[21,] <- c(0,0,0,0,0,0,0,0,0,0,1)
I_2_1[22,] <- c(0,0,0,0,0,0,0,0,0,0,1)

I_2_2 <- matrix(data = NA, nrow = N, ncol = K)
I_2_2[1,] <- c(1,0,0,0,0,0,0,0,0,0,0)
I_2_2[2,] <- c(0,0,0,0,0,0,0,0,1,0,0)  # switch
I_2_2[3,] <- c(0,1,0,0,0,0,0,0,0,0,0)
I_2_2[4,] <- c(0,1,0,0,0,0,0,0,0,0,0)
I_2_2[5,] <- c(0,0,1,0,0,0,0,0,0,0,0)
I_2_2[6,] <- c(0,0,1,0,0,0,0,0,0,0,0)
I_2_2[7,] <- c(0,0,0,1,0,0,0,0,0,0,0)
I_2_2[8,] <- c(0,0,0,1,0,0,0,0,0,0,0)
I_2_2[9,] <- c(0,0,0,0,1,0,0,0,0,0,0)
I_2_2[10,] <- c(0,0,0,0,1,0,0,0,0,0,0)
I_2_2[11,] <- c(0,0,0,0,0,1,0,0,0,0,0)
I_2_2[12,] <- c(0,0,0,0,0,1,0,0,0,0,0)
I_2_2[13,] <- c(0,0,0,0,0,0,1,0,0,0,0)
I_2_2[14,] <- c(0,0,0,0,0,0,1,0,0,0,0)
I_2_2[15,] <- c(0,0,0,0,0,0,0,1,0,0,0)
I_2_2[16,] <- c(0,0,0,0,0,0,0,1,0,0,0)
I_2_2[17,] <- c(1,0,0,0,0,0,0,0,0,0,0)  # switch
I_2_2[18,] <- c(0,0,0,0,0,0,0,0,1,0,0)
I_2_2[19,] <- c(0,0,0,0,0,0,0,0,0,1,0)
I_2_2[20,] <- c(0,0,0,0,0,0,0,0,0,1,0)
I_2_2[21,] <- c(0,0,0,0,0,0,0,0,0,0,1)
I_2_2[22,] <- c(0,0,0,0,0,0,0,0,0,0,1)

I_2 <- list(I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2)

# driver qualifier/race NA indicators
I_1 <- matrix(data = 1, nrow = N, ncol = Q)


# number of ranks per qualifier/race
J <- 22

# initial conditions for latent constructor ability state equation
mu_C_0 <- c(10,9,8,7,6,5,4,3,2,1,0)

# initial conditions for latent driver ability state equation
mu_D_0 <- c(10.25,9.75,9.25,8.75,8.25,
            7.75,7.25,6.75,6.25,5.75,
            5.25,4.75,4.25,3.75,3.25,
            2.75,2.25,1.75,1.25,0.75,
            0.25,-0.25)

# SD for error for latent constructor ability state equation
varsigma_C_sim <- 0.16

# SD for error for latent driver ability state equation
varsigma_D_sim <- 0.04

# cut points
gamma_sim <- seq(from = 0, to = J-2, by = 1)



# model 1 version 1 - missing data ####
# number of constructors in time series
K <- 12

# number of drivers in time series
N <- 51

# number of qualifiers/races
Q <- 159

# constructor qualifier/race NA indicators
I_3 <- matrix(data = 1, nrow = K, ncol = Q)

# NAs for constructor with ID 10 ( manor )
I_3[10,c(16:18,59:159)] <- 0

# NAs for constructor with ID 11 ( caterham )
I_3[11,c(16:17,19:159)] <- 0

# NAs for constructor with ID 12 ( haas )
I_3[12,1:37] <- 0

K * Q - sum(I_3)

# constructor indicators
I_2_1 <- matrix(data = NA, nrow = N, ncol = K)
I_2_1[1,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_1[2,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_1[3,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_1[4,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_1[5,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_1[6,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_1[7,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_1[8,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_1[9,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_1[10,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_1[11,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_1[12,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_1[13,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_1[14,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_1[15,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_1[16,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_1[17,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_1[18,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_1[19,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2_1[20,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2_1[21,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2_1[22,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2_1[23,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)
I_2_1[24,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)
I_2_1[25,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_1[26,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_1[27,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_1[28,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_1[29,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_1[30,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_1[31,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_1[32,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_1[33,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_1[34,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_1[35,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_1[36,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_1[37,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_1[38,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_1[39,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_1[40,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_1[41,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_1[42,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_1[43,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_1[44,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_1[45,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_1[46,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_1[47,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_1[48,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_1[49,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_1[50,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_1[51,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)

I_2_2 <- matrix(data = NA, nrow = N, ncol = K)
I_2_2[1,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_2[2,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)  # switch
I_2_2[3,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_2[4,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)  # switch
I_2_2[5,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_2[6,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)  # switch
I_2_2[7,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_2[8,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_2[9,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_2[10,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_2[11,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_2[12,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_2[13,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_2[14,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)  # switch
I_2_2[15,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_2[16,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)  # switch
I_2_2[17,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_2[18,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)  # switch
I_2_2[19,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2_2[20,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2_2[21,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2_2[22,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2_2[23,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)
I_2_2[24,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)
I_2_2[25,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_2[26,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_2[27,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_2[28,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_2[29,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_2[30,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_2[31,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_2[32,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_2[33,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_2[34,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_2[35,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_2[36,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_2[37,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_2[38,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_2[39,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_2[40,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_2[41,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_2[42,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_2[43,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_2[44,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_2[45,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_2[46,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_2[47,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_2[48,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_2[49,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_2[50,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_2[51,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)

I_2 <- list(I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2)

# driver qualifier/race NA indicators
I_1 <- matrix(data = 1, nrow = N, ncol = Q)

# NAs for drivers with IDs:
# 1, 3, 5, 7, 9, 11, 13, 15, and 18
I_1[c(1,3,5,7,9,11,13,15,17), 40:159] <- 0

# NAs for drivers with IDs:
# 25, 26, 27, 28, 29, 30, 31, 32, and 33
I_1[c(25,26,27,28,29,30,31,32,33), c(1:39,80:159)] <- 0

# NAs for drivers with IDs:
# 34, 35, 36, 37, 38, 39, 40, 41, and 42
I_1[c(34,35,36,37,38,39,40,41,42), c(1:79,120:159)] <- 0

# NAs for drivers with IDs:
# 43, 44, 45, 46, 47, 48, 49, 50, and 51
I_1[c(43,44,45,46,47,48,49,50,51), 1:119] <- 0

# NAs for driver with ID 19 ( manor driver )
I_1[19,c(16:18,59:159)] <- 0

# NAs for driver with ID 20 ( manor driver )
I_1[20,c(16:18,59:159)] <- 0

# NAs for driver with ID 21 ( caterham driver )
I_1[21,c(16:17,19:159)] <- 0

# NAs for driver with ID 22 ( caterham driver )
I_1[22,c(16:17,19:159)] <- 0

# NAs for constructor with ID 23 ( haas driver )
I_1[23,1:37] <- 0

# NAs for constructor with ID 24 ( haas driver )
I_1[24,1:37] <- 0

N * Q - sum(I_1)

# number of ranks per qualifier/race
J <- 22

# initial conditions for latent constructor ability state equation
mu_C_0 <- c(10,9,8,7,6,5,4,3,2,1,0,0)

# initial conditions for latent driver ability state equation
mu_D_0 <- c(10.25,9.75,9.25,8.75,8.25,7.75,7.25,6.75,6.25,
            5.75,5.25,4.75,4.25,3.75,3.25,2.75,2.25,1.75,
            1.25,0.75,0.25,-0.25,
            -0.25,-0.25,
            10.25,9.25,8.25,7.25,6.25,5.25,4.25,3.25,1.75,
            10.25,9.25,8.25,7.25,6.25,5.25,4.25,3.25,1.75,
            10.25,9.25,8.25,7.25,6.25,5.25,4.25,3.25,1.75)

# SD for error for latent constructor ability state equations
varsigma_C_sim <- 0.16

# SD for error for latent driver ability state equations
varsigma_D_sim <- 0.04

# cut points
gamma_sim <- seq(from = 0, to = J-2, by = 1)



# model 1 version 1 - increased fluctuations ####
# number of constructors in time series
K <- 12

# number of drivers in time series
N <- 51

# number of qualifiers/races
Q <- 159

# constructor qualifier/race NA indicators
I_3 <- matrix(data = 1, nrow = K, ncol = Q)

# NAs for constructor with ID 10 ( manor )
I_3[10,c(16:18,59:159)] <- 0

# NAs for constructor with ID 11 ( caterham )
I_3[11,c(16:17,19:159)] <- 0

# NAs for constructor with ID 12 ( haas )
I_3[12,1:37] <- 0

# constructor indicators
I_2_1 <- matrix(data = NA, nrow = N, ncol = K)
I_2_1[1,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_1[2,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_1[3,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_1[4,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_1[5,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_1[6,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_1[7,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_1[8,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_1[9,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_1[10,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_1[11,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_1[12,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_1[13,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_1[14,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_1[15,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_1[16,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_1[17,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_1[18,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_1[19,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2_1[20,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2_1[21,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2_1[22,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2_1[23,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)
I_2_1[24,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)
I_2_1[25,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_1[26,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_1[27,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_1[28,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_1[29,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_1[30,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_1[31,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_1[32,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_1[33,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_1[34,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_1[35,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_1[36,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_1[37,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_1[38,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_1[39,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_1[40,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_1[41,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_1[42,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_1[43,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_1[44,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_1[45,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_1[46,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_1[47,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_1[48,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_1[49,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_1[50,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_1[51,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)

I_2_2 <- matrix(data = NA, nrow = N, ncol = K)
I_2_2[1,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_2[2,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)  # switch
I_2_2[3,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_2[4,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)  # switch
I_2_2[5,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_2[6,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)  # switch
I_2_2[7,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_2[8,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_2[9,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_2[10,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_2[11,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_2[12,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_2[13,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_2[14,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)  # switch
I_2_2[15,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_2[16,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)  # switch
I_2_2[17,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_2[18,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)  # switch
I_2_2[19,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2_2[20,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2_2[21,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2_2[22,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2_2[23,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)
I_2_2[24,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)
I_2_2[25,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_2[26,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_2[27,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_2[28,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_2[29,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_2[30,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_2[31,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_2[32,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_2[33,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_2[34,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_2[35,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_2[36,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_2[37,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_2[38,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_2[39,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_2[40,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_2[41,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_2[42,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_2[43,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_2[44,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_2[45,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_2[46,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_2[47,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_2[48,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_2[49,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_2[50,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_2[51,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_2[44,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_2[45,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_2[46,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_2[47,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_2[48,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_2[49,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_2[50,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_2[51,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)

I_2 <- list(I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2)

# driver qualifier/race NA indicators
I_1 <- matrix(data = 1, nrow = N, ncol = Q)

# NAs for drivers with IDs:
# 1, 3, 5, 7, 9, 11, 13, 15, and 18
I_1[c(1,3,5,7,9,11,13,15,17), 40:159] <- 0

# NAs for drivers with IDs:
# 25, 26, 27, 28, 29, 30, 31, 32, and 33
I_1[c(25,26,27,28,29,30,31,32,33), c(1:39,80:159)] <- 0

# NAs for drivers with IDs:
# 34, 35, 36, 37, 38, 39, 40, 41, and 42
I_1[c(34,35,36,37,38,39,40,41,42), c(1:79,120:159)] <- 0

# NAs for drivers with IDs:
# 43, 44, 45, 46, 47, 48, 49, 50, and 51
I_1[c(43,44,45,46,47,48,49,50,51), 1:119] <- 0

# NAs for driver with ID 19 ( manor driver )
I_1[19,c(16:18,59:159)] <- 0

# NAs for driver with ID 20 ( manor driver )
I_1[20,c(16:18,59:159)] <- 0

# NAs for driver with ID 21 ( caterham driver )
I_1[21,c(16:17,19:159)] <- 0

# NAs for driver with ID 22 ( caterham driver )
I_1[22,c(16:17,19:159)] <- 0

# NAs for constructor with ID 23 ( haas driver )
I_1[23,1:37] <- 0

# NAs for constructor with ID 24 ( haas driver )
I_1[24,1:37] <- 0

N * Q - sum(I_1)

# number of ranks per qualifier/race
J <- 22

# initial conditions for latent constructor ability state equation
mu_C_0 <- c(10,9,8,7,6,5,4,3,2,1,0,0)

# initial conditions for latent driver ability state equation
mu_D_0 <- c(10.25,9.75,9.25,8.75,8.25,7.75,7.25,6.75,6.25,
            5.75,5.25,4.75,4.25,3.75,3.25,2.75,2.25,1.75,
            1.25,0.75,0.25,-0.25,
            -0.25,-0.25,
            10.25,9.25,8.25,7.25,6.25,5.25,4.25,3.25,1.75,
            10.25,9.25,8.25,7.25,6.25,5.25,4.25,3.25,1.75,
            10.25,9.25,8.25,7.25,6.25,5.25,4.25,3.25,1.75)

# SD for error for latent constructor ability state equations
varsigma_C_sim <- 1.4

# SD for error for latent driver ability state equations
varsigma_D_sim <- 0.2

# cut points
gamma_sim <- seq(from = 0, to = J-2, by = 1)



# model 1 version 1 - dominant ctr ability ####
# number of constructors in time series
K <- 12

# number of drivers in time series
N <- 51

# number of qualifiers/races
Q <- 159

# constructor qualifier/race NA indicators
I_3 <- matrix(data = 1, nrow = K, ncol = Q)

# NAs for constructor with ID 10 ( manor )
I_3[10,c(16:18,59:159)] <- 0

# NAs for constructor with ID 11 ( caterham )
I_3[11,c(16:17,19:159)] <- 0

# NAs for constructor with ID 12 ( haas )
I_3[12,1:37] <- 0

# constructor indicators
I_2_1 <- matrix(data = NA, nrow = N, ncol = K)
I_2_1[1,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_1[2,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_1[3,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_1[4,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_1[5,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_1[6,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_1[7,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_1[8,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_1[9,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_1[10,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_1[11,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_1[12,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_1[13,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_1[14,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_1[15,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_1[16,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_1[17,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_1[18,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_1[19,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2_1[20,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2_1[21,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2_1[22,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2_1[23,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)
I_2_1[24,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)
I_2_1[25,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_1[26,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_1[27,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_1[28,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_1[29,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_1[30,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_1[31,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_1[32,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_1[33,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_1[34,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_1[35,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_1[36,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_1[37,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_1[38,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_1[39,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_1[40,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_1[41,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_1[42,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_1[43,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_1[44,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_1[45,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_1[46,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_1[47,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_1[48,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_1[49,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_1[50,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_1[51,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)

I_2_2 <- matrix(data = NA, nrow = N, ncol = K)
I_2_2[1,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_2[2,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)  # switch
I_2_2[3,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_2[4,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)  # switch
I_2_2[5,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_2[6,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)  # switch
I_2_2[7,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_2[8,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_2[9,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_2[10,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_2[11,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_2[12,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_2[13,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_2[14,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)  # switch
I_2_2[15,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_2[16,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)  # switch
I_2_2[17,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_2[18,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)  # switch
I_2_2[19,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2_2[20,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2_2[21,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2_2[22,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2_2[23,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)
I_2_2[24,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)
I_2_2[25,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_2[26,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_2[27,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_2[28,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_2[29,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_2[30,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_2[31,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_2[32,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_2[33,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_2[34,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_2[35,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_2[36,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_2[37,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_2[38,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_2[39,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_2[40,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_2[41,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_2[42,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2_2[43,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2_2[44,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2_2[45,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2_2[46,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2_2[47,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2_2[48,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2_2[49,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2_2[50,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2_2[51,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)

I_2 <- list(I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,I_2_1,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,
            I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2,I_2_2)

# driver qualifier/race NA indicators
I_1 <- matrix(data = 1, nrow = N, ncol = Q)

# NAs for drivers with IDs:
# 1, 3, 5, 7, 9, 11, 13, 15, and 18
I_1[c(1,3,5,7,9,11,13,15,17), 40:159] <- 0

# NAs for drivers with IDs:
# 25, 26, 27, 28, 29, 30, 31, 32, and 33
I_1[c(25,26,27,28,29,30,31,32,33), c(1:39,80:159)] <- 0

# NAs for drivers with IDs:
# 34, 35, 36, 37, 38, 39, 40, 41, and 42
I_1[c(34,35,36,37,38,39,40,41,42), c(1:79,120:159)] <- 0

# NAs for drivers with IDs:
# 43, 44, 45, 46, 47, 48, 49, 50, and 51
I_1[c(43,44,45,46,47,48,49,50,51), 1:119] <- 0

# NAs for driver with ID 19 ( manor driver )
I_1[19,c(16:18,59:159)] <- 0

# NAs for driver with ID 20 ( manor driver )
I_1[20,c(16:18,59:159)] <- 0

# NAs for driver with ID 21 ( caterham driver )
I_1[21,c(16:17,19:159)] <- 0

# NAs for driver with ID 22 ( caterham driver )
I_1[22,c(16:17,19:159)] <- 0

# NAs for constructor with ID 23 ( haas driver )
I_1[23,1:37] <- 0

# NAs for constructor with ID 24 ( haas driver )
I_1[24,1:37] <- 0

N * Q - sum(I_1)

# number of ranks per qualifier/race
J <- 22

# initial conditions for latent constructor ability state equation
v1C <- 0.75 * 21
v2C <- v1C / 10

topC <- v1C - 0.25
bottomC <- -0.25 

ctr_ability_rank <- c(topC,
                      topC - 1 * v2C,
                      topC - 2 * v2C,
                      topC - 3 * v2C,
                      topC - 4 * v2C,
                      topC - 5 * v2C,
                      topC - 6 * v2C,
                      topC - 7 * v2C,
                      topC - 8 * v2C,
                      topC - 9 * v2C,
                      bottomC)


mu_C_0 <- c(ctr_ability_rank[1],
            ctr_ability_rank[2],
            ctr_ability_rank[3],
            ctr_ability_rank[4],
            ctr_ability_rank[5],
            ctr_ability_rank[6],
            ctr_ability_rank[7],
            ctr_ability_rank[8],
            ctr_ability_rank[9],
            ctr_ability_rank[10],
            ctr_ability_rank[11],
            ctr_ability_rank[11])

# initial conditions for latent driver ability state equation
v1D <- 0.25 * 21
v2D <- v1D / 21

topD <- v1D - 0.25
bottomD <- -0.25

drv_ability_rank <- c(topD,
                      topD - 1 * v2D,
                      topD - 2 * v2D,
                      topD - 3 * v2D,
                      topD - 4 * v2D,
                      topD - 5 * v2D,
                      topD - 6 * v2D,
                      topD - 7 * v2D,
                      topD - 8 * v2D,
                      topD - 9 * v2D,
                      topD - 10 * v2D,
                      topD - 11 * v2D,
                      topD - 12 * v2D,
                      topD - 13 * v2D,
                      topD - 14 * v2D,
                      topD - 15 * v2D,
                      topD - 16 * v2D,
                      topD - 17 * v2D,
                      topD - 18 * v2D,
                      topD - 19 * v2D,
                      topD - 20 * v2D,
                      bottomD)

mu_D_0 <- c(drv_ability_rank[1],
            drv_ability_rank[2],
            drv_ability_rank[3],
            drv_ability_rank[4],
            drv_ability_rank[5],
            drv_ability_rank[6],
            drv_ability_rank[7],
            drv_ability_rank[8],
            drv_ability_rank[9],
            drv_ability_rank[10],
            drv_ability_rank[11],
            drv_ability_rank[12],
            drv_ability_rank[13],
            drv_ability_rank[14],
            drv_ability_rank[15],
            drv_ability_rank[16],
            drv_ability_rank[17],
            drv_ability_rank[18],
            drv_ability_rank[19],
            drv_ability_rank[20],
            drv_ability_rank[21],
            drv_ability_rank[22],
            
            drv_ability_rank[21],
            drv_ability_rank[22],
            
            drv_ability_rank[1],
            drv_ability_rank[3],
            drv_ability_rank[5],
            drv_ability_rank[7],
            drv_ability_rank[9],
            drv_ability_rank[11],
            drv_ability_rank[13],
            drv_ability_rank[15],
            drv_ability_rank[17],
            
            drv_ability_rank[1],
            drv_ability_rank[3],
            drv_ability_rank[5],
            drv_ability_rank[7],
            drv_ability_rank[9],
            drv_ability_rank[11],
            drv_ability_rank[13],
            drv_ability_rank[15],
            drv_ability_rank[17],
            
            drv_ability_rank[1],
            drv_ability_rank[3],
            drv_ability_rank[5],
            drv_ability_rank[7],
            drv_ability_rank[9],
            drv_ability_rank[11],
            drv_ability_rank[13],
            drv_ability_rank[15],
            drv_ability_rank[17])

# SD for error for latent constructor ability state equations
varsigma_C_sim <- 1.4

# SD for error for latent driver ability state equations
varsigma_D_sim <- 0.2

# cut points
gamma_sim <- seq(from = 0, to = J-2, by = 1)



# model 1 version 1 - simulation ####
# computation with NUTS in STAN
m1_v1_sim <- stan_model("STAN/m1_v1_sim.stan")

fit_m1_v1_sim <- sampling(m1_v1_sim,
                          data = list(K = K,
                                      N = N,
                                      T = Q,
                                      I_3 = I_3,
                                      I_2 = I_2,
                                      I_1 = I_1,
                                      J = J,
                                      mu_C_0 = mu_C_0,
                                      mu_D_0 = mu_D_0,
                                      varsigma_C = varsigma_C_sim,
                                      varsigma_D = varsigma_D_sim,
                                      gamma = gamma_sim),
                          algorithm = "Fixed_param",
                          iter = 10,
                          warmup = 0)

# save fit_m1_v1_sim
saveRDS(fit_m1_v1_sim,
        "data/fit_m1_v1_sim_dominant_ctr_ability.rds")  # TODO adjust name

# load fit_m1_v1_sim
fit_m1_v1_sim <-
  readRDS("data/fit_m1_v1_sim_missing_data.rds")  # TODO data file


# extract simulations
params_m1_v1_sim <- rstan::extract(fit_m1_v1_sim)


# extract mu_P_sim
mu_P_sim <- params_m1_v1_sim$mu_P[40,,]

# mu_P_without_NA
mu_P_without_NA <- c()

element <- 1

for (n in 1:N) {
  for (t in 1:Q) {
    
    if (I_1[n,t] == 0) {
      mu_P_without_NA[element] <- mu_P_sim[n,t]
      element <- element + 1
    }
    
  }
}

# lower 89% HDI mu_P
round(HPDI(mu_P_without_NA)[1], digits = 4)

# mdn mu_P
round(median(mu_P_without_NA), digits = 4)

# upper 89% HDI mu_P
round(HPDI(mu_P_without_NA)[2], digits = 4)


# extract mu_D_sim
mu_D_sim <- params_m1_v1_sim$mu_D[40,,]

# mu_D_without_NA
mu_D_without_NA <- c()

element <- 1

for (n in 1:N) {
  for (t in 1:Q) {
    
    if (I_1[n,t] == 0) {
      mu_D_without_NA[element] <- mu_D_sim[n,t]
      element <- element + 1
    }
    
  }
}

# lower 89% HDI mu_D
round(HPDI(mu_D_without_NA)[1], digits = 4)

# mdn mu_D
round(median(mu_D_without_NA), digits = 4)

# upper 89% HDI mu_D
round(HPDI(mu_D_without_NA)[2], digits = 4)


# extract mu_C_sim
mu_C_sim <- params_m1_v1_sim$mu_C[40,,]

# mu_C_without_NA
mu_C_without_NA <- c()

element <- 1

for (k in 1:K) {
  for (t in 1:Q) {
    
    if (I_3[k,t] == 0) {
      mu_C_without_NA[element] <- mu_C_sim[n,t]
      element <- element + 1
    }
    
  }
}

# lower 89% HDI mu_C
round(HPDI(mu_C_without_NA)[1], digits = 4)

# mdn mu_C
round(median(mu_C_without_NA), digits = 4)

# upper 89% HDI mu_C
round(HPDI(mu_C_without_NA)[2], digits = 4)


# extract simulated qualifier/race ranks
R_sim_temp <- params_m1_v1_sim$R_sim

R_sim <- R_sim_temp[40,,]


# time series plot
# simulated qualifier/race rank
par(mfrow = c(5,2))
for (n in 1:N) {
  
  plot(R_sim[n,],
       ylim = c(22, 1),
       type="l",
       col = "orange",
       main = paste("driver", n),
       xlab = "qualifier/race",
       ylab = "rank",
       xaxt = "n",
       yaxt = "n")
  axis(side = 1, at = c(1,19,38,59,79,100,121,138,159))
  axis(side = 2, at = c(22, 11, 1), las = 1)
  
  for (t in 1:Q) {
    if (I_1[n,t] == 0) {
      abline(v = t, lwd = 0.125, col = "azure4")
    }
  }
  
  box()
  
}
par(mfrow = c(1,1))



# model 1 version 2 - clean data ####
# number of constructors in time series
K <- 11

# number of ctr cockpits in time series
N <- 22

# number of qualifiers/races
Q <- 159

# constructor qualifier/race NA indicators
I_3 <- matrix(data = 1, nrow = K, ncol = Q)

# constructor indicators
I_2 <- matrix(data = NA, nrow = N, ncol = K)
I_2[1,] <- c(1,0,0,0,0,0,0,0,0,0,0)
I_2[2,] <- c(1,0,0,0,0,0,0,0,0,0,0)
I_2[3,] <- c(0,1,0,0,0,0,0,0,0,0,0)
I_2[4,] <- c(0,1,0,0,0,0,0,0,0,0,0)
I_2[5,] <- c(0,0,1,0,0,0,0,0,0,0,0)
I_2[6,] <- c(0,0,1,0,0,0,0,0,0,0,0)
I_2[7,] <- c(0,0,0,1,0,0,0,0,0,0,0)
I_2[8,] <- c(0,0,0,1,0,0,0,0,0,0,0)
I_2[9,] <- c(0,0,0,0,1,0,0,0,0,0,0)
I_2[10,] <- c(0,0,0,0,1,0,0,0,0,0,0)
I_2[11,] <- c(0,0,0,0,0,1,0,0,0,0,0)
I_2[12,] <- c(0,0,0,0,0,1,0,0,0,0,0)
I_2[13,] <- c(0,0,0,0,0,0,1,0,0,0,0)
I_2[14,] <- c(0,0,0,0,0,0,1,0,0,0,0)
I_2[15,] <- c(0,0,0,0,0,0,0,1,0,0,0)
I_2[16,] <- c(0,0,0,0,0,0,0,1,0,0,0)
I_2[17,] <- c(0,0,0,0,0,0,0,0,1,0,0)
I_2[18,] <- c(0,0,0,0,0,0,0,0,1,0,0)
I_2[19,] <- c(0,0,0,0,0,0,0,0,0,1,0)
I_2[20,] <- c(0,0,0,0,0,0,0,0,0,1,0)
I_2[21,] <- c(0,0,0,0,0,0,0,0,0,0,1)
I_2[22,] <- c(0,0,0,0,0,0,0,0,0,0,1)

I_2 <- list(I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2)

# driver qualifier/race NA indicators
I_1 <- matrix(data = 1, nrow = N, ncol = Q)

# driver change indicators
drv_ctr_cockpit_temp <- read_excel("data/drv_ctr_cockpit_qualifier.xlsx",
                                   sheet = "Sheet 1")

drv_ctr_cokpit <- drv_ctr_cockpit_temp[,-c(1,2)]

drv_ctr_cockpit_rows <- dim(drv_ctr_cokpit)[1]

ctr_cockpits <- c("mercedes1", "mercedes2",
                  "red_bull1", "red_bull2",
                  "mclaren1", "mclaren2",
                  "ferrari1", "ferrari2",
                  "alphatauri1", "alphatauri2",
                  "aston_martin1", "aston_martin2",
                  "williams1", "williams2",
                  "alfa1", "alfa2",
                  "alpine1", "alpine2",
                  "manor1", "manor2",
                  "haas1", "haas2")

I_4 <- matrix(data = 0, nrow = N, ncol = Q)

for (ctr in 1:N) {
  for (t in 2:Q) {
    for(n in 1:drv_ctr_cockpit_rows) {
      if(!is.na(drv_ctr_cokpit[n,t])) {
        
        if(drv_ctr_cokpit[n,t] == ctr_cockpits[ctr] &
           (is.na(drv_ctr_cokpit[n,t-1]) |
            drv_ctr_cokpit[n,t-1] != ctr_cockpits[ctr])) {
          
          I_4[ctr,t] <- 1
          
        }
        
      }
    }
  }
}

sum(I_4)

# number of ranks per qualifier/race
J <- 22

# initial conditions for latent constructor ability state equation
mu_C_0 <- c(10,9,8,7,6,5,4,3,2,1,0)

# initial conditions for latent driver ability state equation
mu_D_0 <- c(10.25,9.75,9.25,8.75,8.25,
            7.75,7.25,6.75,6.25,5.75,
            5.25,4.75,4.25,3.75,3.25,
            2.75,2.25,1.75,1.25,0.75,
            0.25,-0.25)

# SD for error for latent constructor ability state equation
varsigma_C_sim <- 0.16

# SD for error for latent driver ability state equation
# if no driver change
varsigma_D_sim <- 0.04

# SD for error for latent driver ability state equation
# if driver change
kappa_D <- 0.06

# cut points
gamma_sim <- seq(from = 0, to = J-2, by = 1)



# model 1 version 2 - missing data ####
# number of constructors in time series
K <- 12

# number of ctr cockpits in time series
N <- 24

# number of qualifiers/races
Q <- 159

# constructor qualifier/race NA indicators
I_3 <- matrix(data = 1, nrow = K, ncol = Q)

# NAs for constructor with ID 10 ( manor )
I_3[10,c(16:18,59:159)] <- 0

# NAs for constructor with ID 11 ( caterham )
I_3[11,c(16:17,19:159)] <- 0

# NAs for constructor with ID 12 ( haas )
I_3[12,1:37] <- 0

K * Q - sum(I_3)

# constructor indicators
I_2 <- matrix(data = NA, nrow = N, ncol = K)
I_2[1,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2[2,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2[3,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2[4,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2[5,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2[6,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2[7,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2[8,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2[9,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2[10,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2[11,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2[12,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2[13,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2[14,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2[15,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2[16,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2[17,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2[18,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2[19,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2[20,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2[21,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2[22,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2[23,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)
I_2[24,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)

I_2 <- list(I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2)

# driver qualifier/race NA indicators
I_1 <- matrix(data = 1, nrow = N, ncol = Q)

# NAs for driver with ID 19 ( manor driver )
I_1[19,c(16:18,59:159)] <- 0

# NAs for driver with ID 20 ( manor driver )
I_1[20,c(16:18,59:159)] <- 0

# NAs for driver with ID 21 ( caterham driver )
I_1[21,c(16:17,19:159)] <- 0

# NAs for driver with ID 22 ( caterham driver )
I_1[22,c(16:17,19:159)] <- 0

# NAs for constructor with ID 23 ( haas driver )
I_1[23,1:37] <- 0

# NAs for constructor with ID 24 ( haas driver )
I_1[24,1:37] <- 0

N * Q - sum(I_1)

# driver change indicators
drv_ctr_cockpit_temp <- read_excel("data/drv_ctr_cockpit_qualifier.xlsx",
                                   sheet = "Sheet 1")

drv_ctr_cokpit <- drv_ctr_cockpit_temp[,-c(1,2)]

drv_ctr_cockpit_rows <- dim(drv_ctr_cokpit)[1]

ctr_cockpits <- c("mercedes1", "mercedes2",
                  "red_bull1", "red_bull2",
                  "mclaren1", "mclaren2",
                  "ferrari1", "ferrari2",
                  "alphatauri1", "alphatauri2",
                  "aston_martin1", "aston_martin2",
                  "williams1", "williams2",
                  "alfa1", "alfa2",
                  "alpine1", "alpine2",
                  "manor1", "manor2",
                  "caterham1", "caterham2",
                  "haas1", "haas2")

I_5 <- matrix(data = 0, nrow = N, ncol = Q)

for (ctr in 1:N) {
  for (t in 2:Q) {
    for(n in 1:drv_ctr_cockpit_rows) {
      if(!is.na(drv_ctr_cokpit[n,t])) {
        
        if(drv_ctr_cokpit[n,t] == ctr_cockpits[ctr] &
           (is.na(drv_ctr_cokpit[n,t-1]) |
            drv_ctr_cokpit[n,t-1] != ctr_cockpits[ctr])) {
          
          I_5[ctr,t] <- 1
          
        }
        
      }
    }
  }
}

I_5[21,18] <- 0  # special case for caterham1

sum(I_5)

# indicators for no driver change
I_4 <- ifelse(I_5 == 1, 0, 1)

# number of ranks per qualifier/race
J <- 22

# initial conditions for latent constructor ability state equation
mu_C_0 <- c(10,9,8,7,6,5,4,3,2,1,0,0)

# initial conditions for latent driver ability state equation
mu_D_0 <- c(10.25,9.75,9.25,8.75,8.25,
            7.75,7.25,6.75,6.25,5.75,
            5.25,4.75,4.25,3.75,3.25,
            2.75,2.25,1.75,1.25,0.75,
            0.25,-0.25,-0.25,-0.25)

# SD for error for latent constructor ability state equation
varsigma_C_sim <- 0.16

# SD for error for latent driver ability state equation
# if no driver change
varsigma_D_1_sim <- 0.04

# SD for error for latent driver ability state equation
# if driver change
varsigma_D_2_sim <- 2

# cut points
gamma_sim <- seq(from = 0, to = J-2, by = 1)



# model 1 version 2 - increased fluctuations ####
# number of constructors in time series
K <- 12

# number of ctr cockpits in time series
N <- 24

# number of qualifiers/races
Q <- 159

# constructor qualifier/race NA indicators
I_3 <- matrix(data = 1, nrow = K, ncol = Q)

# NAs for constructor with ID 10 ( manor )
I_3[10,c(16:18,59:159)] <- 0

# NAs for constructor with ID 11 ( caterham )
I_3[11,c(16:17,19:159)] <- 0

# NAs for constructor with ID 12 ( haas )
I_3[12,1:37] <- 0

K * Q - sum(I_3)

# constructor indicators
I_2 <- matrix(data = NA, nrow = N, ncol = K)
I_2[1,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2[2,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2[3,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2[4,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2[5,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2[6,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2[7,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2[8,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2[9,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2[10,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2[11,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2[12,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2[13,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2[14,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2[15,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2[16,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2[17,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2[18,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2[19,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2[20,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2[21,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2[22,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2[23,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)
I_2[24,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)

I_2 <- list(I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2)

# driver qualifier/race NA indicators
I_1 <- matrix(data = 1, nrow = N, ncol = Q)

# NAs for driver with ID 19 ( manor driver )
I_1[19,c(16:18,59:159)] <- 0

# NAs for driver with ID 20 ( manor driver )
I_1[20,c(16:18,59:159)] <- 0

# NAs for driver with ID 21 ( caterham driver )
I_1[21,c(16:17,19:159)] <- 0

# NAs for driver with ID 22 ( caterham driver )
I_1[22,c(16:17,19:159)] <- 0

# NAs for constructor with ID 23 ( haas driver )
I_1[23,1:37] <- 0

# NAs for constructor with ID 24 ( haas driver )
I_1[24,1:37] <- 0

N * Q - sum(I_1)

# driver change indicators
drv_ctr_cockpit_temp <- read_excel("data/drv_ctr_cockpit_qualifier.xlsx",
                                   sheet = "Sheet 1")

drv_ctr_cokpit <- drv_ctr_cockpit_temp[,-c(1,2)]

drv_ctr_cockpit_rows <- dim(drv_ctr_cokpit)[1]

ctr_cockpits <- c("mercedes1", "mercedes2",
                  "red_bull1", "red_bull2",
                  "mclaren1", "mclaren2",
                  "ferrari1", "ferrari2",
                  "alphatauri1", "alphatauri2",
                  "aston_martin1", "aston_martin2",
                  "williams1", "williams2",
                  "alfa1", "alfa2",
                  "alpine1", "alpine2",
                  "manor1", "manor2",
                  "caterham1", "caterham2",
                  "haas1", "haas2")

I_5 <- matrix(data = 0, nrow = N, ncol = Q)

for (ctr in 1:N) {
  for (t in 2:Q) {
    for(n in 1:drv_ctr_cockpit_rows) {
      if(!is.na(drv_ctr_cokpit[n,t])) {
        
        if(drv_ctr_cokpit[n,t] == ctr_cockpits[ctr] &
           (is.na(drv_ctr_cokpit[n,t-1]) |
            drv_ctr_cokpit[n,t-1] != ctr_cockpits[ctr])) {
          
          I_5[ctr,t] <- 1
          
        }
        
      }
    }
  }
}

I_5[21,18] <- 0  # special case for caterham1

sum(I_5)

# indicators for no driver change
I_4 <- ifelse(I_5 == 1, 0, 1)

# number of ranks per qualifier/race
J <- 22

# initial conditions for latent constructor ability state equation
mu_C_0 <- c(10,9,8,7,6,5,4,3,2,1,0,0)

# initial conditions for latent driver ability state equation
mu_D_0 <- c(10.25,9.75,9.25,8.75,8.25,
            7.75,7.25,6.75,6.25,5.75,
            5.25,4.75,4.25,3.75,3.25,
            2.75,2.25,1.75,1.25,0.75,
            0.25,-0.25,-0.25,-0.25)

# SD for error for latent constructor ability state equation
# varsigma_C_sim <- 0.16  # increase

# SD for error for latent driver ability state equation
# if no driver change
# varsigma_D_1_sim <- 0.04  # increase

# SD for error for latent driver ability state equation
# if driver change
# varsigma_D_2_sim <- 2  # ???

# cut points
gamma_sim <- seq(from = 0, to = J-2, by = 1)



# model 1 version 2 - dominant ctr ability ####
# number of constructors in time series
K <- 12

# number of ctr cockpits in time series
N <- 24

# number of qualifiers/races
Q <- 159

# constructor qualifier/race NA indicators
I_3 <- matrix(data = 1, nrow = K, ncol = Q)

# NAs for constructor with ID 10 ( manor )
I_3[10,c(16:18,59:159)] <- 0

# NAs for constructor with ID 11 ( caterham )
I_3[11,c(16:17,19:159)] <- 0

# NAs for constructor with ID 12 ( haas )
I_3[12,1:37] <- 0

K * Q - sum(I_3)

# constructor indicators
I_2 <- matrix(data = NA, nrow = N, ncol = K)
I_2[1,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2[2,] <- c(1,0,0,0,0,0,0,0,0,0,0,0)
I_2[3,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2[4,] <- c(0,1,0,0,0,0,0,0,0,0,0,0)
I_2[5,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2[6,] <- c(0,0,1,0,0,0,0,0,0,0,0,0)
I_2[7,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2[8,] <- c(0,0,0,1,0,0,0,0,0,0,0,0)
I_2[9,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2[10,] <- c(0,0,0,0,1,0,0,0,0,0,0,0)
I_2[11,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2[12,] <- c(0,0,0,0,0,1,0,0,0,0,0,0)
I_2[13,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2[14,] <- c(0,0,0,0,0,0,1,0,0,0,0,0)
I_2[15,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2[16,] <- c(0,0,0,0,0,0,0,1,0,0,0,0)
I_2[17,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2[18,] <- c(0,0,0,0,0,0,0,0,1,0,0,0)
I_2[19,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2[20,] <- c(0,0,0,0,0,0,0,0,0,1,0,0)
I_2[21,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2[22,] <- c(0,0,0,0,0,0,0,0,0,0,1,0)
I_2[23,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)
I_2[24,] <- c(0,0,0,0,0,0,0,0,0,0,0,1)

I_2 <- list(I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,
            I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2,I_2)

# driver qualifier/race NA indicators
I_1 <- matrix(data = 1, nrow = N, ncol = Q)

# NAs for driver with ID 19 ( manor driver )
I_1[19,c(16:18,59:159)] <- 0

# NAs for driver with ID 20 ( manor driver )
I_1[20,c(16:18,59:159)] <- 0

# NAs for driver with ID 21 ( caterham driver )
I_1[21,c(16:17,19:159)] <- 0

# NAs for driver with ID 22 ( caterham driver )
I_1[22,c(16:17,19:159)] <- 0

# NAs for constructor with ID 23 ( haas driver )
I_1[23,1:37] <- 0

# NAs for constructor with ID 24 ( haas driver )
I_1[24,1:37] <- 0

N * Q - sum(I_1)

# driver change indicators
drv_ctr_cockpit_temp <- read_excel("data/drv_ctr_cockpit_qualifier.xlsx",
                                   sheet = "Sheet 1")

drv_ctr_cokpit <- drv_ctr_cockpit_temp[,-c(1,2)]

drv_ctr_cockpit_rows <- dim(drv_ctr_cokpit)[1]

ctr_cockpits <- c("mercedes1", "mercedes2",
                  "red_bull1", "red_bull2",
                  "mclaren1", "mclaren2",
                  "ferrari1", "ferrari2",
                  "alphatauri1", "alphatauri2",
                  "aston_martin1", "aston_martin2",
                  "williams1", "williams2",
                  "alfa1", "alfa2",
                  "alpine1", "alpine2",
                  "manor1", "manor2",
                  "caterham1", "caterham2",
                  "haas1", "haas2")

I_5 <- matrix(data = 0, nrow = N, ncol = Q)

for (ctr in 1:N) {
  for (t in 2:Q) {
    for(n in 1:drv_ctr_cockpit_rows) {
      if(!is.na(drv_ctr_cokpit[n,t])) {
        
        if(drv_ctr_cokpit[n,t] == ctr_cockpits[ctr] &
           (is.na(drv_ctr_cokpit[n,t-1]) |
            drv_ctr_cokpit[n,t-1] != ctr_cockpits[ctr])) {
          
          I_5[ctr,t] <- 1
          
        }
        
      }
    }
  }
}

I_5[21,18] <- 0  # special case for caterham1

sum(I_5)

# indicators for no driver change
I_4 <- ifelse(I_5 == 1, 0, 1)

# number of ranks per qualifier/race
J <- 22

# initial conditions for latent constructor ability state equation
v1C <- 0.75 * 21
v2C <- v1C / 10

topC <- v1C - 0.25
bottomC <- -0.25 

ctr_ability_rank <- c(topC,
                      topC - 1 * v2C,
                      topC - 2 * v2C,
                      topC - 3 * v2C,
                      topC - 4 * v2C,
                      topC - 5 * v2C,
                      topC - 6 * v2C,
                      topC - 7 * v2C,
                      topC - 8 * v2C,
                      topC - 9 * v2C,
                      bottomC)


mu_C_0 <- c(ctr_ability_rank[1],
            ctr_ability_rank[2],
            ctr_ability_rank[3],
            ctr_ability_rank[4],
            ctr_ability_rank[5],
            ctr_ability_rank[6],
            ctr_ability_rank[7],
            ctr_ability_rank[8],
            ctr_ability_rank[9],
            ctr_ability_rank[10],
            ctr_ability_rank[11],
            ctr_ability_rank[11])

# initial conditions for latent driver ability state equation
v1D <- 0.25 * 21
v2D <- v1D / 21

topD <- v1D - 0.25
bottomD <- -0.25

drv_ability_rank <- c(topD,
                      topD - 1 * v2D,
                      topD - 2 * v2D,
                      topD - 3 * v2D,
                      topD - 4 * v2D,
                      topD - 5 * v2D,
                      topD - 6 * v2D,
                      topD - 7 * v2D,
                      topD - 8 * v2D,
                      topD - 9 * v2D,
                      topD - 10 * v2D,
                      topD - 11 * v2D,
                      topD - 12 * v2D,
                      topD - 13 * v2D,
                      topD - 14 * v2D,
                      topD - 15 * v2D,
                      topD - 16 * v2D,
                      topD - 17 * v2D,
                      topD - 18 * v2D,
                      topD - 19 * v2D,
                      topD - 20 * v2D,
                      bottomD)

mu_D_0 <- c(drv_ability_rank[1],
            drv_ability_rank[2],
            drv_ability_rank[3],
            drv_ability_rank[4],
            drv_ability_rank[5],
            drv_ability_rank[6],
            drv_ability_rank[7],
            drv_ability_rank[8],
            drv_ability_rank[9],
            drv_ability_rank[10],
            drv_ability_rank[11],
            drv_ability_rank[12],
            drv_ability_rank[13],
            drv_ability_rank[14],
            drv_ability_rank[15],
            drv_ability_rank[16],
            drv_ability_rank[17],
            drv_ability_rank[18],
            drv_ability_rank[19],
            drv_ability_rank[20],
            drv_ability_rank[21],
            drv_ability_rank[22],
            drv_ability_rank[21],
            drv_ability_rank[22])

# SD for error for latent constructor ability state equation
# varsigma_C_sim <- 0.16  # adjust

# SD for error for latent driver ability state equation
# if no driver change
# varsigma_D_1_sim <- 0.04  # adjust

# SD for error for latent driver ability state equation
# if driver change
# varsigma_D_2_sim <- 2 # ( adjust )

# cut points
gamma_sim <- seq(from = 0, to = J-2, by = 1)



# model 1 version 2 - simulation ####
# computation with NUTS in STAN
m1_v2_sim <- stan_model("STAN/m1_v2_sim_test.stan")

fit_m1_v2_sim <- sampling(m1_v2_sim,
                          data = list(K = K,
                                      N = N,
                                      T = Q,
                                      I_3 = I_3,
                                      I_2 = I_2,
                                      I_1 = I_1,
                                      I_4 = I_4,
                                      J = J,
                                      mu_C_0 = mu_C_0,
                                      mu_D_0 = mu_D_0,
                                      varsigma_C = varsigma_C_sim,
                                      varsigma_D = varsigma_D_sim,
                                      kappa_D = kappa_D,
                                      gamma = gamma_sim),
                          algorithm = "Fixed_param",
                          iter = 10,
                          warmup = 0)

# save fit_m1_v2_sim
saveRDS(fit_m1_v2_sim,
        "data/fit_m1_v2_sim_clean_data_test.rds")  # TODO adjust name

# load fit_m1_v2_sim
fit_m1_v2_sim <-
  readRDS("data/fit_m1_v2_sim_clean_data_test.rds")  # TODO data file


# extract simulations
params_m1_v2_sim <- rstan::extract(fit_m1_v2_sim)


# extract mu_P_sim
mu_P_sim <- params_m1_v2_sim$mu_P[40,,]

# mu_P_without_NA
mu_P_without_NA <- c()

element <- 1

for (n in 1:N) {
  for (t in 1:Q) {
    
    if (I_1[n,t] == 0) {
      mu_P_without_NA[element] <- mu_P_sim[n,t]
      element <- element + 1
    }
    
  }
}

# lower 89% HDI mu_P
round(HPDI(mu_P_without_NA)[1], digits = 4)

# mdn mu_P
round(median(mu_P_without_NA), digits = 4)

# upper 89% HDI mu_P
round(HPDI(mu_P_without_NA)[2], digits = 4)


# extract mu_D_sim
mu_D_sim <- params_m1_v2_sim$mu_D[40,,]

# mu_D_without_NA
mu_D_without_NA <- c()

element <- 1

for (n in 1:N) {
  for (t in 1:Q) {
    
    if (I_1[n,t] == 0) {
      mu_D_without_NA[element] <- mu_D_sim[n,t]
      element <- element + 1
    }
    
  }
}

# lower 89% HDI mu_D
round(HPDI(mu_D_without_NA)[1], digits = 4)

# mdn mu_D
round(median(mu_D_without_NA), digits = 4)

# upper 89% HDI mu_D
round(HPDI(mu_D_without_NA)[2], digits = 4)


# extract mu_C_sim
mu_C_sim <- params_m1_v2_sim$mu_C[40,,]

# mu_C_without_NA
mu_C_without_NA <- c()

element <- 1

for (k in 1:K) {
  for (t in 1:Q) {
    
    if (I_3[k,t] == 0) {
      mu_C_without_NA[element] <- mu_C_sim[n,t]
      element <- element + 1
    }
    
  }
}

# lower 89% HDI mu_C
round(HPDI(mu_C_without_NA)[1], digits = 4)

# mdn mu_C
round(median(mu_C_without_NA), digits = 4)

# upper 89% HDI mu_C
round(HPDI(mu_C_without_NA)[2], digits = 4)


# extract simulated qualifier/race ranks
R_sim_temp <- params_m1_v2_sim$R_sim

R_sim <- R_sim_temp[40,,]


# time series plot
# simulated qualifier/race rank
par(mfrow = c(5,2))
for (n in 1:N) {
  
  plot(R_sim[n,],
       ylim = c(22, 1),
       type="l",
       col = "orange",
       main = paste("ctr cockpit", n),
       xlab = "qualifier/race",
       ylab = "rank",
       xaxt = "n",
       yaxt = "n")
  axis(side = 1, at = c(1,19,38,59,79,100,121,138,159))
  axis(side = 2, at = c(22, 11, 1), las = 1)
  
  for (t in 1:Q) {
    if (I_1[n,t] == 0) {
      abline(v = t, lwd = 0.125, col = "azure4")
    }
  }
  
  box()
  
}
par(mfrow = c(1,1))


